<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="Hello! In this blog post I am going to be showing an example of how to implement the Maybe Monad in Typescript. It seems tremendously common for anyone learning functional programming to write their own version of an &ldquo;Explaining Monads&rdquo; blog post. I am glad to keep up the tradition.
Why worry about a Maybe type in the first place?
Good question! The day to day work of a web developer requires handling all kinds of values that may, or may not exist. Using a consistent unambiguous pattern for handling these potentially missing values is incredibly helpful. It not only makes your code easier to read, but less prone to errors as well.">  

  <title>
    
      Bringing the Maybe Monad to Typescript
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="//localhost:1313/css/main.900100e9dbee2d56c58fac8bb717037cae7e26a9c36c29d2ff587bdd65f0cbbe510b41d81a3bb234919cdfdc7550d786b2fab70c8fc507772d732fe097106d12.css" integrity="sha512-kAEA6dvuLVbFj6yLtxcDfK5&#43;JqnDbCnS/1h73WXwy75RC0HYGjuyNJGc39x1UNeGsvq3DI/FB3ctcy/glxBtEg==" />
  
</head>
<body a="light">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2023-05-12 00:00:00 &#43;0000 UTC">
            2023-05-12
        </time>
    </p>

    <h1>Bringing the Maybe Monad to Typescript</h1>

    

    <p>Hello! In this blog post I am going to be showing an example of how to implement the Maybe Monad in Typescript. It seems tremendously common for anyone learning functional programming to write their own version of an &ldquo;Explaining Monads&rdquo; blog post. I am glad to keep up the tradition.</p>
<h3 id="why-worry-about-a-maybe-type-in-the-first-place">Why worry about a Maybe type in the first place?</h3>
<p>Good question! The day to day work of a web developer requires handling all kinds of values that may, or may not exist. Using a consistent unambiguous pattern for handling these potentially missing values is incredibly helpful. It not only makes your code easier to read, but less prone to errors as well.</p>
<p>Without further adieu, let&rsquo;s get into it.</p>
<h4 id="the-maybe-type">The Maybe type</h4>
<p>The Maybe type is actually rather simple. It is either a value of type T or nothing. Nothing being either <code>null</code> or <code>undefined</code> in Javascript land.</p>
<p>Here&rsquo;s the Maybe type definition.</p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">type</span> Maybe&lt;T&gt; <span style="color:#00538b">=</span> T <span style="color:#00538b">|</span> <span style="color:#0000c0">undefined</span> <span style="color:#00538b">|</span> <span style="color:#0000c0">null</span>;
</span></span></code></pre></div><p>This type helps with defining values in code that are potentially missing. For instance, imagine we receive a list of drinks from a server. The list of drinks contains <code>Drink</code> objects which contain fields <code>name</code>, <code>color</code>, and <code>caffeineContent</code> ( which may or may not be included based on the drink ). Let&rsquo;s build a function that looks up a drink by <code>name</code> and prints the <code>caffeineContent</code> value if it exists using the Maybe type.</p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">type</span> Drink <span style="color:#00538b">=</span> {
</span></span><span style="display:flex;"><span>  name: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  color: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  caffeineContent: <span style="color:#005a5f">Maybe</span>&lt;number&gt;;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">const</span> drinks: <span style="color:#005a5f">Drink</span>[] <span style="color:#00538b">=</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;coffee&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;black&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">79</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;sprite&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;clear&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">null</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">function</span> lookupCaffeineCont(name: <span style="color:#005a5f">string</span>, drinks: <span style="color:#005a5f">Drink</span>[])<span style="color:#00538b">:</span> Maybe&lt;number&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">const</span> drink: <span style="color:#005a5f">Maybe</span>&lt;Drink&gt; <span style="color:#00538b">=</span> drinks.find((drink) <span style="color:#00538b">=&gt;</span> drink.name <span style="color:#00538b">===</span> name);
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">if</span>(drink <span style="color:#00538b">!==</span> <span style="color:#0000c0">undefined</span> <span style="color:#00538b">&amp;&amp;</span> drink <span style="color:#00538b">!==</span> <span style="color:#0000c0">null</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span>(drink.caffeineContent <span style="color:#00538b">!==</span> <span style="color:#0000c0">undefined</span> <span style="color:#00538b">&amp;&amp;</span> drink.caffeineContent <span style="color:#00538b">!==</span> <span style="color:#0000c0">null</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#5317ac">return</span> drink.caffeineContent;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> <span style="color:#0000c0">null</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">return</span> <span style="color:#0000c0">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="unwrapping-the-maybe-type">Unwrapping the Maybe type</h2>
<p>In this example the <code>Maybe</code> type saves us time by not forcing us to explicitly type each potentially missing value. At each step we have to handle each <code>Maybe</code> value before moving on. These if statements are kind of messy. To help clean this up we can use a helper function <code>exists</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">function</span> exists&lt;T&gt;(val: <span style="color:#005a5f">T</span>)<span style="color:#00538b">:</span> val <span style="color:#5317ac">is</span> Exclude&lt;T, null | undefined&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">return</span> val <span style="color:#00538b">!==</span> <span style="color:#0000c0">undefined</span> <span style="color:#00538b">&amp;&amp;</span> val <span style="color:#00538b">!==</span> <span style="color:#0000c0">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can then refactor the previous example.<br>
<em>Note: It is possible to combine both if statements into a single statement, but I want each step to be discernible. This will help with understanding what the Maybe Monad is abstracting away.</em></p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">type</span> Drink <span style="color:#00538b">=</span> {
</span></span><span style="display:flex;"><span>  name: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  color: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  caffeineContent: <span style="color:#005a5f">Maybe</span>&lt;number&gt;;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">const</span> drinks: <span style="color:#005a5f">Drink</span>[] <span style="color:#00538b">=</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;coffee&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;black&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">79</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;sprite&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;clear&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">null</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">function</span> lookupCaffeineCont(name: <span style="color:#005a5f">string</span>, drinks: <span style="color:#005a5f">Drink</span>[])<span style="color:#00538b">:</span> Maybe&lt;number&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">const</span> drink: <span style="color:#005a5f">Maybe</span>&lt;Drink&gt; <span style="color:#00538b">=</span> drinks.find((drink) <span style="color:#00538b">=&gt;</span> drink.name <span style="color:#00538b">===</span> name);
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">if</span>(exists(drink)){
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span>(exists(drink.caffeineContent)){
</span></span><span style="display:flex;"><span>      <span style="color:#5317ac">return</span> drink.caffeineContent;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> <span style="color:#0000c0">null</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">return</span> <span style="color:#0000c0">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is quite cumbersome and annoying to deal with though. This tactic require wrapping every resulting value in a Maybe type, un-boxing it, using the un-boxed value, and then repeating.</p>
<h3 id="the-monad--abstracting-away-unwrapping-and-re-wrapping-maybe-">The Monad ( Abstracting away unwrapping and re-wrapping Maybe )</h3>
<p>It turns out that a Monad is actually exactly what we need to abstract away all of this annoying un-boxing stuff.</p>
<p>The Maybe Monad includes four functions.</p>
<p><em>map</em>: This unwraps the <code>MaybeM</code> type, injects it into a function <code>T -&gt; R</code> and wraps it into a <code>MaybeM</code> type on return. If the inner value is <code>Nothing</code> then it just immediately returns <code>Nothing</code>.</p>
<p><em>fMap:</em> This function takes a function of type <code>T -&gt; MaybeM&lt;R&gt;</code>. It un-boxes the internal value of MaybeM and injects the un-boxed value into the given function if the internal value is defined. If the internal value is undefined fMap just returns <code>MaybeM.none()</code>. None being a valid member of <code>MaybeM&lt;R&gt;</code>.</p>
<p><em>lift:</em> This function takes some value of type T and returns <code>Maybe&lt;T&gt;</code>.</p>
<p><em>unwrap</em>: This just unwraps the inner value. Generally Monads don&rsquo;t provide a function to do this, but <code>unwrap</code> makes using the monad in Typescript easier.</p>
<h3 id="the-implementation">The Implementation</h3>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">class</span> MaybeM&lt;T&gt; {
</span></span><span style="display:flex;"><span>  val: <span style="color:#005a5f">Maybe</span>&lt;T&gt;;
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">constructor</span>(value: <span style="color:#005a5f">Maybe</span>&lt;T&gt;) {
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">this</span>.val <span style="color:#00538b">=</span> value;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">static</span> lift&lt;T&gt;(value: <span style="color:#005a5f">Maybe</span>&lt;T&gt;){
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span>(exists(value)){
</span></span><span style="display:flex;"><span>      <span style="color:#5317ac">return</span> <span style="color:#5317ac">new</span> MaybeM&lt;T&gt;(value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> <span style="color:#5317ac">new</span> MaybeM&lt;T&gt;(<span style="color:#0000c0">null</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">static</span> some&lt;R&gt;(value: <span style="color:#005a5f">R</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> MaybeM.lift&lt;R&gt;(value);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">static</span> none&lt;R&gt;(){
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> MaybeM.lift&lt;R&gt;(<span style="color:#0000c0">null</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  fMap&lt;R&gt;(fn<span style="color:#00538b">:</span> (arg: <span style="color:#005a5f">T</span>) <span style="color:#00538b">=&gt;</span> MaybeM&lt;R&gt;)<span style="color:#00538b">:</span> MaybeM&lt;R&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span>(exists(<span style="color:#5317ac">this</span>.val)){
</span></span><span style="display:flex;"><span>      <span style="color:#5317ac">return</span> fn(<span style="color:#5317ac">this</span>.val);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> MaybeM.none&lt;R&gt;();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  map&lt;R&gt;(fn<span style="color:#00538b">:</span> (arg: <span style="color:#005a5f">T</span>) <span style="color:#00538b">=&gt;</span> R)<span style="color:#00538b">:</span> MaybeM&lt;R&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span>(exists(<span style="color:#5317ac">this</span>.val)){
</span></span><span style="display:flex;"><span>      <span style="color:#5317ac">return</span> MaybeM.some&lt;R&gt;(fn(<span style="color:#5317ac">this</span>.val));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> MaybeM.none&lt;R&gt;();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  unwrap()<span style="color:#00538b">:</span> T {
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">return</span> <span style="color:#5317ac">this</span>.val;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="usage-of-maybem">Usage of MaybeM</h3>
<p>We can then use the Monadic Maybe like so.</p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">type</span> Drink <span style="color:#00538b">=</span> {
</span></span><span style="display:flex;"><span>  name: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  color: <span style="color:#005a5f">string</span>;
</span></span><span style="display:flex;"><span>  caffeineContent: <span style="color:#005a5f">Maybe</span>&lt;number&gt;;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">const</span> drinks: <span style="color:#005a5f">Drink</span>[] <span style="color:#00538b">=</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;coffee&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;black&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">79</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    name<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;sprite&#34;</span>,
</span></span><span style="display:flex;"><span>    color<span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;clear&#34;</span>,
</span></span><span style="display:flex;"><span>    caffeineContent: <span style="color:#005a5f">null</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">function</span> lookupCaffeineCont(name: <span style="color:#005a5f">string</span>, drinks: <span style="color:#005a5f">Drink</span>[])<span style="color:#00538b">:</span> Maybe&lt;number&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">const</span> caffeine <span style="color:#00538b">=</span> 
</span></span><span style="display:flex;"><span>    MaybeM.lift(drinks.find((d) <span style="color:#00538b">=&gt;</span> d.name <span style="color:#00538b">===</span> name))
</span></span><span style="display:flex;"><span>    .map((drink) <span style="color:#00538b">=&gt;</span> drink.caffeineContent)
</span></span><span style="display:flex;"><span>    .unwrap();
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">return</span> caffeine;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We could even find the caffeine content for every drink, determine if it is high, and make a new list of all high caffeine drinks.</p>
<div class="highlight"><pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#5317ac">const</span> allCaffeine: <span style="color:#005a5f">string</span>[] <span style="color:#00538b">=</span> drinks.map(drink <span style="color:#00538b">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">const</span> level: <span style="color:#005a5f">Maybe</span>&lt;string&gt; <span style="color:#00538b">=</span> MaybeM.lift(drink)
</span></span><span style="display:flex;"><span>                              .fMap(drink <span style="color:#00538b">=&gt;</span> MaybeM.lift(drink.caffeineContent))
</span></span><span style="display:flex;"><span>                              .map(caff <span style="color:#00538b">=&gt;</span> caff <span style="color:#00538b">&gt;</span> <span style="color:#0000c0">50</span> <span style="color:#00538b">?</span> <span style="color:#2544bb">&#34;HIGH&#34;</span> <span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;LOW&#34;</span> )
</span></span><span style="display:flex;"><span>                              .unwrap();
</span></span><span style="display:flex;"><span>  <span style="color:#5317ac">return</span> exists(level) <span style="color:#00538b">?</span> level <span style="color:#00538b">:</span> <span style="color:#2544bb">&#34;N/A&#34;</span>;
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>This will never hit the final logging statement. The Maybe Monad abstracts away the continual/nested checking required when handling potentially missing values!</p>
<p>We use <code>fMap</code> because <code>drink.caffeineContent</code> is potentially undefined. Because it could be missing we need to lift it into <code>MaybeM</code>. <code>fMap</code> doesn&rsquo;t wrap the result of it&rsquo;s function in <code>MaybeM</code> like <code>map</code> does. Using <code>fMap</code> allows us to &ldquo;flatten&rdquo; our result so that we don&rsquo;t end up nested.</p>

</article>

                
    
    
        &ldquo;Lisp isn&rsquo;t a language, it&rsquo;s a building material.&rdquo; - Alan Kay
    


            </div>
        </main>
    </body>
</html>
